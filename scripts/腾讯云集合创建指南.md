# 腾讯云 CloudBase 集合创建指南

## 📋 需要创建的集合

官网需要创建以下5个集合（前缀：`web_`）：

1. **web_users** - 用户表
2. **web_favorites** - 收藏表
3. **web_custom_sites** - 自定义网站表
4. **web_subscriptions** - 订阅表
5. **web_payment_transactions** - 支付记录表

---

## 🔧 创建步骤

### 1. 登录腾讯云控制台

```
网址：https://console.cloud.tencent.com/tcb
环境ID：cloudbase-1gnip2iaa08260e5
```

### 2. 进入数据库管理

1. 选择环境：`cloudbase-1gnip2iaa08260e5`
2. 左侧菜单 → 点击 **"数据库"**
3. 点击 **"集合"** 标签

---

## 📦 集合1：web_users（用户表）

### 创建集合
- 点击 **"新建集合"**
- 集合名称：`web_users`
- 点击 **"确定"**

### 字段说明
```javascript
{
  "_id": "自动生成",              // 用户ID
  "_openid": "微信OpenID",        // 微信登录用的OpenID
  "email": "用户邮箱",            // 邮箱（如果用邮箱注册）
  "nickname": "用户昵称",
  "avatar": "头像URL",
  "created_at": "注册时间",
  "updated_at": "最后更新时间"
}
```

### 索引（可选优化）
- 在 **"索引"** 标签添加：
  - 字段：`_openid`，类型：单字段索引（唯一）
  - 字段：`email`，类型：单字段索引（唯一）

---

## 📦 集合2：web_favorites（收藏表）

### 创建集合
- 点击 **"新建集合"**
- 集合名称：`web_favorites`
- 点击 **"确定"**

### 字段说明
```javascript
{
  "_id": "自动生成",
  "user_id": "用户ID（关联web_users._id）",
  "site_id": "网站ID",
  "created_at": "收藏时间"
}
```

### 索引（可选优化）
- 字段：`user_id`，类型：单字段索引
- 字段：`site_id`，类型：单字段索引

---

## 📦 集合3：web_custom_sites（自定义网站表）

### 创建集合
- 点击 **"新建集合"**
- 集合名称：`web_custom_sites`
- 点击 **"确定"**

### 字段说明
```javascript
{
  "_id": "自动生成",
  "user_id": "用户ID",
  "name": "网站名称",
  "url": "网站URL",
  "logo": "网站图标（emoji或URL）",
  "category": "分类（默认：tools）",
  "description": "描述",
  "created_at": "创建时间",
  "updated_at": "更新时间"
}
```

### 索引（可选优化）
- 字段：`user_id`，类型：单字段索引

---

## 📦 集合4：web_subscriptions（订阅表）

### 创建集合
- 点击 **"新建集合"**
- 集合名称：`web_subscriptions`
- 点击 **"确定"**

### 字段说明
```javascript
{
  "_id": "自动生成",
  "user_id": "用户ID（唯一）",
  "user_email": "用户邮箱",
  "plan_type": "套餐类型（pro/team）",
  "billing_cycle": "计费周期（monthly/yearly）",
  "status": "状态（active/expired/cancelled）",
  "payment_method": "支付方式（wechat/alipay）",
  "current_period_start": "当前周期开始时间",
  "current_period_end": "当前周期结束时间",
  "cancel_at_period_end": "是否周期结束时取消",
  "created_at": "创建时间",
  "updated_at": "更新时间"
}
```

### 索引（可选优化）
- 字段：`user_id`，类型：单字段索引（唯一）
- 字段：`status`，类型：单字段索引

---

## 📦 集合5：web_payment_transactions（支付记录表）

### 创建集合
- 点击 **"新建集合"**
- 集合名称：`web_payment_transactions`
- 点击 **"确定"**

### 字段说明
```javascript
{
  "_id": "自动生成",
  "user_id": "用户ID",
  "user_email": "用户邮箱",
  "plan_type": "套餐类型",
  "billing_cycle": "计费周期",
  "amount_cny": "金额（人民币）",
  "payment_method": "支付方式（wechat/alipay）",
  "transaction_id": "交易ID（唯一）",
  "status": "状态（pending/completed/failed/cancelled）",
  "created_at": "创建时间",
  "updated_at": "更新时间"
}
```

### 索引（可选优化）
- 字段：`user_id`，类型：单字段索引
- 字段：`transaction_id`，类型：单字段索引（唯一）
- 字段：`status`，类型：单字段索引

---

## ✅ 验证检查清单

创建完成后，检查：

- [ ] 左侧集合列表中看到5个新集合
- [ ] 每个集合都能正常打开
- [ ] 集合名称前缀都是 `web_`
- [ ] 可以手动添加测试数据

---

## 🔒 权限配置（重要！）

### 默认权限设置

在 **"数据库"** → **"权限设置"** 中：

1. **开发阶段（推荐）：**
   - 所有集合：`仅创建者可读写`
   - 方便调试和测试

2. **生产阶段：**
   - 需要配置更细致的权限规则
   - 确保用户只能访问自己的数据

---

## 📝 完成后的验证

### 测试连接
```javascript
// 在微信云开发控制台 → 云函数测试
const db = wx.cloud.database()

// 测试查询
db.collection('web_users').get().then(res => {
  console.log('✅ 连接成功:', res)
})
```

---

## 🆘 常见问题

### Q1: 找不到"新建集合"按钮？
**A:** 确保已选择正确的环境ID，并且在"数据库"→"集合"标签下。

### Q2: 创建集合时提示"权限不足"？
**A:** 需要管理员权限。请联系腾讯云账号管理员。

### Q3: 集合创建后无法访问？
**A:** 检查权限设置，确保设置为"仅创建者可读写"或"所有用户可读写"（仅开发环境）。

---

## 📞 需要帮助？

如有问题请联系：
- 邮箱：mornscience@gmail.com
- 文档：https://cloud.tencent.com/document/product/876

---

**完成后请告知，我们继续下一步！** ✅

